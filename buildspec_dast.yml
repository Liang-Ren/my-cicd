version: 0.2
phases:
  build:
    commands:
      - echo "Running OWASP ZAP baseline scan..."
      - |
        set +e
        docker run --rm -v $(pwd):/zap/wrk -t zaproxy/zap-stable zap-baseline.py -t "$TARGET_URL" -m 5 -r zap_report.html
        EXIT_CODE=$?
        echo "ZAP exit code: $EXIT_CODE"
        if [ ! -f zap_report.html ]; then
          echo "ZAP scan failed or DockerHub rate limit reached" > zap_report.html
        fi
        set -e
